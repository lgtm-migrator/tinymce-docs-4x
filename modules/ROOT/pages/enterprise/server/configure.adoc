:rootDir: ../../
:partialsDir: {rootDir}partials/
= Configure
:description: Configure the Enterprise server-side components.
:keywords: enterprise tinymcespellchecker spell check checker pro pricing imagetools server configuration configure

[[creating-a-configuration-file]]
== Creating a configuration file
anchor:creatingaconfigurationfile[historical anchor]

NOTE: Use a plain text editor (such as gedit, vim, emacs or notepad) when creating or editing the `application.conf` file. Do not use word processors like Microsoft Word or Evernote as these can insert extra characters which make the file unreadable to the server-side components.

The TinyMCE server-side components require a configuration file to function correctly. By convention, this file is named `application.conf`.

This configuration file will require you to enter _at least_ the following  information:

* `allowed-origins` - the domains allowed to communicate with the server-side editor features. This is required by all server-side components.

Some server-side components require additional configuration which can be found in their individual documentation:

* link:{baseurl}/enterprise/embed-media/mediaembed-server-config.html[Enhanced Media Embed]
* link:{baseurl}/enterprise/check-links/#linkcheckersdkquicksetup[Link Checker]

[[allowed-origins-required]]
=== `allowed-origins` (required)
anchor:allowed-originsrequired[historical anchor]

TinyMCE editor instances make use of the server-side components by performing a cross-origin HTTP request. These requests are subject to a form of HTTP access control called Cross-Origin Resource Sharing (CORS). CORS is built into web browsers and is not a feature of TinyMCE's server side components. A detailed explanation of CORS can be found on the https://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS[Mozilla Developer Network].

The `allowed-origins` element configures a list of *all* values that can be expected by the server-side components in a HTTP Origin header from your TinyMCE instances (see the https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Origin[Mozilla Developer Network] for more information on the HTTP Origin header). In short, you'll need to supply a list of all the URLs that your TinyMCE instances will be served from without the path information.

This is best illustrated with some examples:

If users load TinyMCE from the following URLs:

* `http://server.example.com/editor.php`
* `http://server.example.com/subpage/editor.php`

Add `http://server.example.com` to the `allowed-origins` list.

If users load TinyMCE from the following URLs:

* `https://server.example.com/editor.php`
* `http://server.example.com/subpage/editor.php`

Add `http://server.example.com` and `https://server.example.com` to the `allowed-origins` list.

If users load TinyMCE from the following URLs:

* `https://server.example.com/editor.php`
* `https://server.example.com/`

Add `https://server.example.com` to the `allowed-origins` list.

If users load TinyMCE from the following URLs:

* `http://oneserver.example.com/editor.php`
* `http://twoserver.example.com/subpage/editor.php`

Add `http://oneserver.example.com` and `http://twoserver.example.com` to the``allowed-origins`` list.

NOTE: If some of your URLs include a port then add an entry with and without the port. The value of the `Origin` header may be different across browsers. Add both to be safe.

If users load TinyMCE from the following URLs:

* `http://server.example.com:8080/editor.php`

Add `http://server.example.com:8080` and `http://server.example.com` to the `allowed-origins` list.

If users load TinyMCE from the following URLs:

* `https://server.example.com:9000/editor.php`

Add `https://server.example.com:9000` and `https://server.example.com` to the `allowed-origins` list.

|===
|  |  |

| *element*
| `allowed-origins`
| Stores CORS setup information

| *attribute*
| `origins`
| An array of strings containing all possible values of the HTTP Origin header the server-side components can expect.
|===

Example:

----
ephox {
	allowed-origins {
		origins = [ "http://myserver", "http://myserver.example.com", "http://myserver:8080", "http://myotherserver", "http://myotherserver:9090", "https://mysecureserver" ]
	}
}
----

[[wildcard-support]]
==== Wildcard support
anchor:wildcardsupport[historical anchor]

The `*` wildcard character matches any value. Wildcards are supported in the following parts of entries in the `allowed-origin` list:

. The scheme (e.g. `*://mydomain.com`). Omitting the scheme entirely is equivalent (e.g. `mydomain.com`).
. The port (e.g. `http://mydomain.com:*`).
. As a prefix of the domain (e.g. `http://*.mydomain.com`).
. Any combination of scheme, port, and domain prefix (e.g. `*://*.mydomain.com:*`).
. As the only character (e.g. `*`). This will allow *any* Origin to access the server-side components.
. As the only character after the scheme (e.g. `https://*`). This will allow *any* Origin serving TinyMCE from a HTTPS page to access the server-side components.

NOTE: Options 5 and 6 allow a broad set of origins access to the server-side components and are NOT recommended for production deployments.

----
ephox {
	allowed-origins {
		origins = [ "http://myserver:*", "*://myotherserver.example.com", "*://*.mydomain.example.com:*"]
	}
}
----

[[troubleshooting-origins]]
==== Troubleshooting Origins
anchor:troubleshootingorigins[historical anchor]

If you missed an Origin or specified an Origin incorrectly, TinyMCE features that rely on the server-side components will not work from that Origin. If you observe that requests to the server-side components are failing or features are unavailable and you're not sure why, refer to the troubleshooting information about link:{baseurl}/enterprise/server/troubleshoot/#usingbrowsertoolingtoinvestigateservicesissues[Using browser tooling to investigate services issues].

[[proxy-optional]]
=== `proxy` (optional)
anchor:proxyoptional[historical anchor]

This element configures use of an HTTP proxy for outgoing HTTP/HTTPS requests made by the server-side components.

Default proxy settings are picked up from JVM system properties, usually provided on the command line, as defined in http://docs.oracle.com/javase/8/docs/api/java/net/doc-files/net-properties.html[Networking Properties for Java]. The system properties `http.proxyHost`, `http.proxyPort`, `http.nonProxyHosts`, `https.proxyHost`, `https.proxyPort` are recognized as well as `http.proxyUser` and `http.proxyPassword` to support authenticating proxies.

This optional proxy element provides an alternative to providing proxy settings as JVM system properties, or to override system properties.

|===
|  |  |

| *element*
| `proxy`
| Stores HTTP outgoing proxy settings for the server-side components.

| *attribute*
| `http.proxyHost`
| A string defining the host name of the proxy for plain HTTP (not HTTPS) connections. (Mandatory)

| *attribute*
| `http.proxyPort`
| An integer defining the port number of the proxy for plain HTTP (not HTTPS) connections. (Mandatory)

| *attribute*
| `http.nonProxyHosts`
| A list of strings separated by vertical lines ("\|") listing hosts and domains to be excluded from proxying, for *both* plain HTTP and HTTPS connections. The strings can contain asterisks ("*") as wildcards. (Optional, defaults to "localhost\|127.*\|[::1]" if not set.)

| *attribute*
| `https.proxyHost`
| A string defining the host name of the proxy for HTTPS connections. (Optional)

| *attribute*
| `https.proxyPort`
| An integer defining the port number of the proxy for HTTPS connections. (Optional)

| *attribute*
| `http.proxyUser`
| Username for authenticating to *both* the HTTP and HTTPS proxy. (Optional)

| *attribute*
| `http.proxyPassword`
| Password for authenticating to *both* the HTTP and HTTPS proxy. (Optional)
|===

In the following example, both HTTP and HTTPS connections (except to localhost and the example.com domain) are proxied through someproxy.example.com on port 8080 and someproxy.example.com does not require authentication.

----
ephox {
    proxy {
        http.proxyHost = "someproxy.example.com"
        http.proxyPort = "8080"
        https.proxyHost = "someproxy.example.com"
        https.proxyPort = "8080"
        http.nonProxyHosts = "localhost|*.example.com"
    }
}
----

[[http-optional]]
=== `http` (optional)
anchor:httpoptional[historical anchor]

Some server-side components make outbound HTTP and HTTPS connections. These include Link Checker, Enhanced Media Embed and Image Tools Proxy. In an evaluation or pre-production environment, you might want to test these features against resources with untrusted SSL certificates such as in-house servers with self-signed SSL certificates. In these circumstances, it is possible to bypass all SSL security.

This is not recommended for production environments.

|===
|  |  |

| *element*
| `http`
| Configures  HTTP client behaviour.

| *attribute*
| `trust-all-cert`
| A boolean indicating whether to bypass SSL security and indiscriminately trusts all SSL certificates. Default: false

| *attribute*
| `request-timeout-seconds`
| An integer defining the number of seconds to allow HTTP requests to take. Default: 10
|===

Example:

----
ephox {
    http {
        trust-all-cert = true
    }
}
----

The request timeout on outbound HTTP and HTTPS connections can be set. Setting this to a larger value will allow larger files through, but they may take a long time. An example might be if you expect to fetch very large files with the image proxy service.

Example:

----
ephox {
    http {
        request-timeout-seconds = 15
    }
}
----

[[image-proxy-optional]]
=== `image-proxy` (optional)
anchor:image-proxyoptional[historical anchor]

The link:{baseurl}/plugins/imagetools.html[image proxy service] has some optional configuration to set a maximum size for images proxied. Images beyond this size it will not be proxied. Please note that the `http.request-timeout-seconds` above also applies to requests made by the image proxy service.

|===
|  |  |

| *element*
| `image-proxy`
| Configures image proxy behaviour.

| *attribute*
| `size-limit`
| An integer defining the maximum allowed image size in bytes. Default: 10000000
|===

Example:

----
ephox {
    image-proxy {
        image-size = 10000000 // 10MB in bytes
    }
}
----

[[logging]]
== Logging

It may be useful to make the TinyMCE server-side components write to their own log file. This can assist in troubleshooting and make it easier to provide logs as part of a support ticket.

To write the logs to a specific file, you'll need to perform the following steps:

[[step-1-create-a-logging-configuration-xml-file]]
=== Step 1. Create a logging configuration XML file
anchor:step1createaloggingconfigurationxmlfile[historical anchor]

The TinyMCE server-side components use the http://logback.qos.ch/manual/configuration.html[Logback] logging format.

Save the snippet below as `logback.xml` after replacing `{$LOG_LOCATION}` with the full path to the destination log file (e.g. /var/log/tinymce_server_components.log).

[source,xml]
----
<configuration>

  <appender name="STDOUT" class="ch.qos.logback.core.ConsoleAppender">
	<encoder>
	  <pattern>%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n</pattern>
	</encoder>
  </appender>

  <appender name="FILE" class="ch.qos.logback.core.FileAppender">
	<file>{$LOG_LOCATION}</file>
	<encoder>
	  <pattern>%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n</pattern>
	</encoder>
  </appender>

  <!-- The name "com.ephox" refers to all TinyMCE server-side components. -->
  <logger name="com.ephox" level="INFO"/>

  <root level="INFO">
	<appender-ref ref="FILE" />
	<!-- If you want logging to go to the container as well uncomment
	the following line -->
	<!-- <appender-ref ref="STDOUT" /> -->
  </root>

</configuration>
----

[[step-2-pass-the-configuration-file-to-the-java-application-server]]
=== Step 2. Pass the configuration file to the Java application server
anchor:step2passtheconfigurationfiletothejavaapplicationserver[historical anchor]

Assuming you've saved your `logback.xml` file in `/etc/opt/tinymce`, follow link:{baseurl}/enterprise/server/#step4passtheconfigurationfiletothejavaapplicationserver[step 4] and link:{baseurl}/enterprise/server/#step5restartthejavaapplicationserver[step 5] on the _Install Server-side Components_ page to set the following JVM system property on your Java application server:

----
-Dlogback.configurationFile=/etc/opt/tinymce/logback.xml
----
